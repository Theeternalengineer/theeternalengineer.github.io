<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wrapped</title>
  <link rel="stylesheet" href="wrapped.css?v=5" />
</head>

<body>

  <a class="home-btn" href="index.html" aria-label="Volver al inicio">Home</a>

  <!-- Audio opcional (requiere archivo local en tu carpeta) -->
  <audio
    id="bgAudio"
    preload="auto"
    loop
    src="dancing-in-the-moonlight-toploader.mp3"
  ></audio>

  <main class="wrapped" id="wrappedApp" aria-label="Wrapped en formato stories">
    <div class="progress" id="progress" aria-hidden="true"></div>

    <!-- 1 -->
    <section class="slide active" data-title="Intro">
      <div class="content">
        <p class="kicker">Nuestro 2025 en varias stories</p>
        <h1 class="title">Pinkidinkiidou x The_realgenaro<br>Wrapped</h1>
        <p class="sub">Tap para avanzar · Mantén presionado para pausar</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="0"></span></div>
    </section>

    <!-- 2 -->
    <section class="slide" data-title="Tiempo juntos">
      <div class="content">
        <p class="kicker">Llevamos juntos</p>
        <h2 class="title">Desde el 18 de octubre de 2025</h2>
        <div class="statCard">
          <div class="statBig" id="sinceClock">—</div>
          <div class="statSmall">días · horas · min · seg</div>
        </div>
        <p class="note">Actualizándose en tiempo real.</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="1"></span></div>
    </section>

    <!-- 3 -->
    <section class="slide" data-title="Mensajes">
      <div class="content">
        <p class="kicker"></p>
        <h2 class="title">Nos hemos enviado alrededor de</h2>
        <div class="statCard">
          <div class="statBig" id="messagesCount">—</div>
          <div class="statSmall"></div>
        </div>
        <p class="note">En definitiva, tenemos bastante tiempo libre</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="2"></span></div>
    </section>

    <!-- 4 -->
    <section class="slide" data-title="El verdadero inicio">
      <div class="content">
        <p class="kicker">peeeero…</p>
        <h2 class="title">Nuestra historia verdaderamente comenzó el 5 de agosto de 2024</h2>
        <p class="body">Contigo y un “Holi” que tardaría un poco… pero que nos traería hasta aquí.</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="3"></span></div>
    </section>

    <!-- 5 -->
    <section class="slide" data-title="Distanciamientos">
      <div class="content">
        <p class="kicker">plot twist</p>
        <h2 class="title">Tuvimos 3 veces un pequeño distanciamiento</h2>
        <p class="body">Hasta que el 23 de agosto eso acabó… y volvimos a conectar.</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="4"></span></div>
    </section>

    <!-- 6 -->
    <section class="slide" data-title="Momentos memorables">
      <div class="content">
        <p class="kicker">y aún así…</p>
        <h2 class="title">Dentro de todo esto, tenemos varios momentos muy memorables</h2>
        <p class="body">Son más de los que están aquí… pero no sé programar xd</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="5"></span></div>
    </section>

    <!-- 7 -->
    <section class="slide" data-title="Highlight 1">
      <div class="content">
        <p class="kicker">Highlight</p>
        <h2 class="title">La parte donde todo se sintió simple</h2>
        <p class="body">(Aquí va un recuerdo corto, 1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="6"></span></div>
    </section>

    <!-- 8 -->
    <section class="slide" data-title="Highlight 2">
      <div class="content">
        <p class="kicker">Highlight</p>
        <h2 class="title">La parte donde nos elegimos</h2>
        <p class="body">(Aquí va un recuerdo corto, 1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="7"></span></div>
    </section>

    <!-- 9 -->
    <section class="slide" data-title="Highlight 3">
      <div class="content">
        <p class="kicker">Highlight</p>
        <h2 class="title">La parte donde el mundo bajó el volumen</h2>
        <p class="body">(Aquí va un recuerdo corto, 1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="8"></span></div>
    </section>

    <!-- 10 -->
    <section class="slide" data-title="Antes del Top 5">
      <div class="content">
        <p class="kicker">Ahora sí</p>
        <h2 class="title">Top 5 momentos</h2>
        <p class="body">Cinco stories, cinco recuerdos. Uno por pantalla.</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="9"></span></div>
    </section>

    <!-- 11 -->
    <section class="slide" data-title="Top 1">
      <div class="content">
        <p class="kicker">Top 1</p>
        <h2 class="title">(Momento 1)</h2>
        <p class="body">(1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="10"></span></div>
    </section>

    <!-- 12 -->
    <section class="slide" data-title="Top 2">
      <div class="content">
        <p class="kicker">Top 2</p>
        <h2 class="title">(Momento 2)</h2>
        <p class="body">(1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="11"></span></div>
    </section>

    <!-- 13 -->
    <section class="slide" data-title="Top 3">
      <div class="content">
        <p class="kicker">Top 3</p>
        <h2 class="title">(Momento 3)</h2>
        <p class="body">(1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="12"></span></div>
    </section>

    <!-- 14 -->
    <section class="slide" data-title="Top 4">
      <div class="content">
        <p class="kicker">Top 4</p>
        <h2 class="title">(Momento 4)</h2>
        <p class="body">(1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="13"></span></div>
    </section>

    <!-- 15 -->
    <section class="slide" data-title="Top 5">
      <div class="content">
        <p class="kicker">Top 5</p>
        <h2 class="title">(Momento 5)</h2>
        <p class="body">(1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="14"></span></div>
    </section>

    <!-- 16 -->
    <section class="slide" data-title="Recap 1">
      <div class="content">
        <p class="kicker">Recap</p>
        <h2 class="title">Lo que nos sostiene</h2>
        <p class="body">(1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="15"></span></div>
    </section>

    <!-- 17 -->
    <section class="slide" data-title="Recap 2">
      <div class="content">
        <p class="kicker">Recap</p>
        <h2 class="title">Lo que aprendimos</h2>
        <p class="body">(1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="16"></span></div>
    </section>

    <!-- 18 -->
    <section class="slide" data-title="Recap 3">
      <div class="content">
        <p class="kicker">Recap</p>
        <h2 class="title">Lo que viene</h2>
        <p class="body">(1–2 líneas)</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="17"></span></div>
    </section>

    <!-- 19 -->
    <section class="slide" data-title="Recap 4">
      <div class="content">
        <p class="kicker">Recap</p>
        <h2 class="title">Mi parte favorita</h2>
        <p class="body">Que en todo esto… sigues siendo tú.</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="18"></span></div>
    </section>

    <!-- 20 -->
    <section class="slide" data-title="Cierre">
      <div class="content">
        <p class="kicker">Final</p>
        <h2 class="title">Por más recuerdos juntos en 2026</h2>
        <p class="body">y apuntando a una vida llena de recuerdos.</p>

        <div class="ctaRow">
          <button class="cta" id="restartBtn" type="button">Regresar al inicio</button>
          <button class="cta ctaGhost" id="nextSectionBtn" type="button">Siguiente sección</button>
        </div>

        <p class="note">El botón “Siguiente sección” está listo para conectarse después.</p>
      </div>
      <div class="song">Canción: <span class="songName" data-song-index="19"></span></div>
    </section>
  </main>

  <script>
    (function () {
      const CONFIG = {
        startDateISO: "2025-10-18T00:00:00-06:00",
        messagesSent: 2400,
        storyMs: 5200
      };

      const app = document.getElementById("wrappedApp");
      const slides = Array.from(document.querySelectorAll(".slide"));
      const progress = document.getElementById("progress");

      const sinceClock = document.getElementById("sinceClock");
      const messagesCount = document.getElementById("messagesCount");

      const restartBtn = document.getElementById("restartBtn");
      const nextSectionBtn = document.getElementById("nextSectionBtn");

      const bgAudio = document.getElementById("bgAudio");
      let audioArmed = false;

      // ===== Songs =====
      const songs = Array.from({ length: slides.length }, (_, i) => `Pendiente (Story ${i + 1})`);
      songs[0] = "Dancing in the Moonlight — Toploader";

      document.querySelectorAll(".songName").forEach((el) => {
        const idx = Number(el.getAttribute("data-song-index"));
        el.textContent = songs[idx] ?? "Pendiente";
      });

      // ===== Init values =====
      if (messagesCount) messagesCount.textContent = `${CONFIG.messagesSent.toLocaleString("es-MX")} mensajes`;

      // ===== Fondo por slide: g1..g20 (como ya lo tienes en wrapped.css) =====
      slides.forEach((s, i) => s.classList.add(`g${Math.min(i + 1, 20)}`));

      // ===== Layouts automáticos (si tu wrapped.css trae layout-a/b/c/d/e) =====
      const layoutCycle = ["layout-a", "layout-b", "layout-c", "layout-d", "layout-b"];
      slides.forEach((s, i) => {
        s.classList.add(layoutCycle[i % layoutCycle.length]);

        if (i === 0) { s.classList.remove(...layoutCycle); s.classList.add("layout-a"); }
        if (i === 1 || i === 2) { s.classList.remove(...layoutCycle); s.classList.add("layout-c"); }
        if (i === 3 || i === 4 || i === 5) { s.classList.remove(...layoutCycle); s.classList.add("layout-d"); }
        if (i === 9) { s.classList.remove(...layoutCycle); s.classList.add("layout-a"); }
        if (i >= 10 && i <= 14) { s.classList.remove(...layoutCycle); s.classList.add("layout-e"); }
        if (i === slides.length - 1) { s.classList.remove(...layoutCycle); s.classList.add("layout-a"); }

        if (i >= 10 && i <= 14) {
          const big = String(i - 9);
          const content = s.querySelector(".content");
          if (content) content.setAttribute("data-big", big);
        }
      });

      // ===== Progress bars =====
      progress.style.setProperty("--n", slides.length);
      progress.innerHTML = "";

      const bars = [];
      for (let i = 0; i < slides.length; i++) {
        const bar = document.createElement("div");
        bar.className = "bar";
        const fill = document.createElement("div");
        fill.className = "fill";
        bar.appendChild(fill);
        progress.appendChild(bar);
        bars.push({ bar, fill });
      }

      function setBarClasses(activeIndex) {
        bars.forEach((b, i) => {
          b.bar.classList.toggle("active", i === activeIndex);
          b.bar.classList.toggle("done", i < activeIndex);
          if (i > activeIndex) b.fill.style.width = "0%";
          if (i < activeIndex) b.fill.style.width = "100%";
        });
      }

      // ===== Stories engine (RAF) =====
      let current = 0;
      let paused = false;
      let storyStart = 0;
      let elapsed = 0;
      let rafId = null;

      function stopRaf() {
        if (rafId) cancelAnimationFrame(rafId);
        rafId = null;
      }

      function show(index) {
        stopRaf();

        current = Math.max(0, Math.min(slides.length - 1, index));
        slides.forEach((s, i) => s.classList.toggle("active", i === current));
        setBarClasses(current);

        paused = false;
        elapsed = 0;
        storyStart = 0;

        if (current === slides.length - 1) {
          bars[current].fill.style.width = "100%";
          return;
        }
        rafId = requestAnimationFrame(tick);
      }

      function tick(ts) {
        if (!storyStart) storyStart = ts;

        if (!paused) {
          const delta = ts - storyStart;
          storyStart = ts;
          elapsed += delta;

          const p = Math.min(1, elapsed / CONFIG.storyMs);
          bars[current].fill.style.width = (p * 100).toFixed(3) + "%";

          if (p >= 1) {
            show(current + 1);
            return;
          }
        } else {
          storyStart = ts;
        }
        rafId = requestAnimationFrame(tick);
      }

      function next(){ if (current < slides.length - 1) show(current + 1); }
      function prev(){ if (current > 0) show(current - 1); }
      function pauseStory(){ if (current !== slides.length - 1) paused = true; }
      function resumeStory(){ if (current !== slides.length - 1) paused = false; }

      // ===== Audio start helper =====
      async function tryStartAudio() {
        if (!bgAudio || audioArmed) return;
        audioArmed = true;
        try {
          bgAudio.volume = 0.55;
          await bgAudio.play();
        } catch (e) {
          // Autoplay bloqueado o archivo no existe: ignora sin romper nada
        }
      }

      // Tap nav (izq prev / der next)
      app.addEventListener("click", (e) => {
        const t = e.target;
        if (t && (t.tagName === "BUTTON" || t.closest("button"))) return;
        if (paused) return;

        tryStartAudio();

        const x = e.clientX;
        const w = window.innerWidth;
        if (x < w * 0.28) prev();
        else next();
      });

      // Hold to pause
      app.addEventListener("mousedown", (e) => {
        const t = e.target;
        if (t && (t.tagName === "BUTTON" || t.closest("button"))) return;
        tryStartAudio();
        pauseStory();
      });
      window.addEventListener("mouseup", () => resumeStory());

      app.addEventListener("touchstart", (e) => {
        const t = e.target;
        if (t && (t.tagName === "BUTTON" || t.closest("button"))) return;
        tryStartAudio();
        pauseStory();
      }, { passive: true });
      window.addEventListener("touchend", () => resumeStory(), { passive: true });

      // Keyboard
      window.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight" || e.key === " " || e.key === "Enter") { e.preventDefault(); tryStartAudio(); next(); }
        if (e.key === "ArrowLeft") { e.preventDefault(); tryStartAudio(); prev(); }
      });

      // Pause on tab switch
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) pauseStory();
        else resumeStory();
      });

      // CTA
      if (restartBtn) restartBtn.addEventListener("click", () => { tryStartAudio(); show(0); });
      if (nextSectionBtn) nextSectionBtn.addEventListener("click", () => alert("Siguiente sección: listo para conectarse."));

      // Live clock
      const startMs = new Date(CONFIG.startDateISO).getTime();
      const pad2 = (n) => String(n).padStart(2, "0");
      function tickClock() {
        if (!sinceClock) return;
        const now = Date.now();
        const diff = Math.max(0, now - startMs);
        const sec = Math.floor(diff / 1000);
        const days = Math.floor(sec / 86400);
        const hours = Math.floor((sec % 86400) / 3600);
        const mins = Math.floor((sec % 3600) / 60);
        const s = sec % 60;
        sinceClock.textContent = `${days} días · ${pad2(hours)}:${pad2(mins)}:${pad2(s)}`;
      }
      tickClock();
      setInterval(tickClock, 1000);

      // Start
      show(0);
    })();
  </script>

</body>
</html>
