<!-- wrapped.html -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wrapped</title>
  <link rel="stylesheet" href="wrapped.css?v=8" />
</head>

<body>

  <a class="home-btn" href="index.html" aria-label="Volver al inicio">Home</a>

  <!-- Botón de silencio / sonido (un poquito más abajo) -->
  <button class="mute-btn" id="muteBtn" type="button" aria-label="Silenciar o activar sonido">
    Sonido
  </button>

  <!-- Audio (archivo local en tu carpeta) -->
  <audio
    id="bgAudio"
    preload="auto"
    loop
    src="The Only Exception.mp3"
  ></audio>

  <main class="wrapped" id="wrappedApp" aria-label="Wrapped en formato stories">
    <div class="progress" id="progress" aria-hidden="true"></div>

    <!-- 1 -->
    <section class="slide active" data-title="Intro">
      <div class="content">
        <p class="kicker">Nuestro 2025 en varias stories</p>
        <h1 class="title">Pinkidinkiidou x The_realgenaro<br>Wrapped</h1>
        <p class="sub">Tap para avanzar · Mantén presionado para pausar</p>
      </div>

      <!-- SOLO AQUÍ aparece la canción -->
      <div class="song">Canción: <span class="songName" data-song-index="0"></span></div>
    </section>

    <!-- 2 -->
    <section class="slide" data-title="Tiempo juntos">
      <div class="content">
        <p class="kicker">Llevamos juntos</p>
        <h2 class="title">Desde el 18 de octubre de 2025</h2>
        <div class="statCard">
          <div class="statBig" id="sinceClock">—</div>
          <div class="statSmall">días · horas · min · seg</div>
        </div>
        <p class="note">Actualizándose en tiempo real.</p>
      </div>
    </section>

    <!-- 3 -->
    <section class="slide" data-title="Mensajes">
      <div class="content">
        <p class="kicker"></p>
        <h2 class="title">Nos hemos enviado alrededor de</h2>
        <div class="statCard">
          <div class="statBig" id="messagesCount">—</div>
          <div class="statSmall"></div>
        </div>
        <p class="note">En definitiva, tenemos bastante tiempo libre</p>
      </div>
    </section>

    <!-- 4 -->
    <section class="slide" data-title="El verdadero inicio">
      <div class="content">
        <p class="kicker">peeeero…</p>
        <h2 class="title">Nuestra historia verdaderamente comenzó el 5 de agosto de 2024</h2>
        <p class="body">Contigo y un “Holi” que tardaría un poco… pero que nos traería hasta aquí.</p>
      </div>
    </section>

    <!-- 5 -->
    <section class="slide" data-title="Distanciamientos">
      <div class="content">
        <p class="kicker">plot twist</p>
        <h2 class="title">Tuvimos 3 veces un pequeño distanciamiento</h2>
        <p class="body">Hasta que el 23 de agosto eso acabó… y volvimos a conectar.</p>
      </div>
    </section>

    <!-- 6 -->
    <section class="slide" data-title="Momentos memorables">
      <div class="content">
        <p class="kicker">y aún así…</p>
        <h2 class="title">Dentro de todo esto, tenemos varios momentos muy memorables</h2>
        <p class="body">Son más de los que están aquí… pero no sé programar xd</p>
      </div>
    </section>

    <!-- 7 -->
    <section class="slide" data-title="Highlight 1">
      <div class="content">
        <p class="kicker">Highlight</p>
        <h2 class="title">La primera vez que te vi</h2>

        <p class="body">
          Todavía me acuerdo de ir saliendo de Querétaro y replanteándome todo.
          Y luego estar afuera de tu depa, esperándote… yo muriéndome de miedo
          (de que fueras un señor pelón o algo así JAJAJA).
          Pero cuando por fin te vi, supe que todo valía la pena.
        </p>

        <div class="photoGrid" aria-label="Fotos de nuestro primer encuentro">
          <figure class="photoCard">
            <img src="5CEAFE04-830F-49FA-897E-FB85603F5378.JPEG" alt="Flores blancas" loading="lazy">
          </figure>

          <figure class="photoCard">
            <img src="IMG_0024.JPEG" alt="Nuestra primera date" loading="lazy">
          </figure>
        </div>

        <p class="note">De ahí… nuestra primera date.</p>
      </div>
    </section>

    <!-- 8 -->
    <section class="slide" data-title="Highlight 2">
      <div class="content">
        <p class="kicker">Highlight</p>
        <h2 class="title">Y ahora, el día en que oficialmente todo comenzó.</h2>

        <div class="photoGrid single" aria-label="Foto del 18 de octubre">
          <figure class="photoCard">
            <img src="story8.JPEG" alt="Recuerdo del 18 de octubre" loading="lazy">
          </figure>
        </div>
        <p class="body">
          18 de octubre. Yo pensé que hasta me dirías que era pronto para comenzar,
          ya que apenas nos veíamos por primera vez. Pero tras más de 1 año de intentarlo contigo,
          valía la pena arriesgarse.
        </p>
      </div>
    </section>

    <!-- 9 -->
    <section class="slide" data-title="Conocernos más">
      <div class="content">
        <p class="kicker">Desde entonces…</p>
        <h2 class="title">Te he ido conociendo más y más</h2>
        <p class="body">
          He amado cada parte de ti <strong>(even the weird ones jajajajaja)</strong>.
          Y estoy seguro que aún me falta bastante por conocer de ti…
          <br><br>
          Hasta ahora solo sé que…
        </p>
      </div>
    </section>

    <!-- 10 -->
    <section class="slide" data-title="Peligro público">
      <div class="content">
        <p class="kicker">Dato curioso (y preocupante)</p>
        <h2 class="title">
          Has estado muy cerca de convertirte en un<br>
          <span class="highlight danger">PELIGRO PARA LA SOCIEDAD</span>
        </h2>
        <p class="body">
          unas <span class="big-number">14</span> veces.
        </p>
      </div>
    </section>

    <!-- 11 -->
    <section class="slide" data-title="Expresiones icónicas">
      <div class="content">
        <p class="kicker">Análisis lingüístico no solicitado</p>
        <h2 class="title">
          Has dicho <span class="highlight yay">“yay”</span><br>
          (y todas sus variantes posibles)
        </h2>
        <p class="body">
          al menos <span class="big-number">70+</span> veces.
          <br><br>
          <span class="subtle">
            yay · yaaay · yai · yayyy · YAAY · y a y
          </span>
        </p>
      </div>
    </section>

    <!-- 12 -->
    <section class="slide" data-title="Un momento clave">
      <div class="content">
        <p class="kicker">Momento histórico</p>

        <h2 class="title">
          Me dijiste <span class="highlight love">“te amo”</span><br>
          por primera vez
        </h2>

        <p class="body">
          el <strong>17 de noviembre</strong><br>
          a las <strong>9:36 pm</strong>.
          <br><br>
          Un momento completamente inolvidable para mí.
        </p>

        <p class="body">
          Y desde entonces, nos lo hemos dicho<br>
          alrededor de <span class="big-number">90+</span> veces.
        </p>
      </div>
    </section>

    <!-- 13 -->
    <section class="slide highlight-layout" data-title="La canción">
      <div class="highlight-card">

        <div class="highlight-text">
          <span class="highlight-label">Y por último</span>

          <h2 class="highlight-title">
            No soy muy bueno<br>
            con las palabras.
          </h2>

          <p class="highlight-body">
            Y por algunas fallas técnicas no pude poner más stories.
            <br><br>
            Pero hay una canción que dice exactamente lo que siento.
            Es la que mejor me representa contigo,
            y por eso te la dedico.
            <br><br>
            <strong>Paramore — The Only Exception</strong>
          </p>
        </div>

        <div class="highlight-media">
          <img src="paramore-the-only-exception.jpg" alt="Paramore - The Only Exception">
        </div>

      </div>
    </section>

    <!-- 20 -->
    <section class="slide" data-title="Cierre">
      <div class="content">
        <p class="kicker">Final</p>
        <h2 class="title">Por más recuerdos juntos en 2026</h2>
        <p class="body">y apuntando a una vida llena de recuerdos.</p>

        <div class="ctaRow">
          <button class="cta" id="restartBtn" type="button">Regresar al inicio</button>
          <button class="cta ctaGhost" id="nextSectionBtn" type="button">Siguiente sección</button>
        </div>

        <p class="note"></p>
      </div>
    </section>
  </main>

  <script>
    (function () {
      const CONFIG = {
        startDateISO: "2025-10-18T00:00:00-06:00",
        messagesSent: 2400,
        storyMs: 5200
      };

      const app = document.getElementById("wrappedApp");
      const slides = Array.from(document.querySelectorAll(".slide"));
      const progress = document.getElementById("progress");

      const sinceClock = document.getElementById("sinceClock");
      const messagesCount = document.getElementById("messagesCount");

      const restartBtn = document.getElementById("restartBtn");
      const nextSectionBtn = document.getElementById("nextSectionBtn");

      const bgAudio = document.getElementById("bgAudio");
      const muteBtn = document.getElementById("muteBtn");

      let audioArmed = false;
      let isMuted = false;

      // ===== Song label (solo Story 1) =====
      document.querySelectorAll(".songName").forEach((el) => {
        el.textContent = "The Only Exception — Paramore";
      });

      // ===== Init values =====
      if (messagesCount) messagesCount.textContent = `${CONFIG.messagesSent.toLocaleString("es-MX")} mensajes`;

      // ===== Fondo por slide: g1..g20 =====
      slides.forEach((s, i) => s.classList.add(`g${Math.min(i + 1, 20)}`));

      // ===== Layouts automáticos =====
      const layoutCycle = ["layout-a", "layout-b", "layout-c", "layout-d", "layout-b"];
      slides.forEach((s, i) => {
        s.classList.add(layoutCycle[i % layoutCycle.length]);

        if (i === 0) { s.classList.remove(...layoutCycle); s.classList.add("layout-a"); }
        if (i === 1 || i === 2) { s.classList.remove(...layoutCycle); s.classList.add("layout-c"); }
        if (i === 3 || i === 4 || i === 5) { s.classList.remove(...layoutCycle); s.classList.add("layout-d"); }
        if (i === 9) { s.classList.remove(...layoutCycle); s.classList.add("layout-a"); }
        if (i >= 10 && i <= 11) { s.classList.remove(...layoutCycle); s.classList.add("layout-e"); }
        if (i === slides.length - 1) { s.classList.remove(...layoutCycle); s.classList.add("layout-a"); }

        if (i >= 10 && i <= 11) {
          const big = String(i - 9);
          const content = s.querySelector(".content");
          if (content) content.setAttribute("data-big", big);
        }
      });

      // ===== Progress bars =====
      progress.style.setProperty("--n", slides.length);
      progress.innerHTML = "";

      const bars = [];
      for (let i = 0; i < slides.length; i++) {
        const bar = document.createElement("div");
        bar.className = "bar";
        const fill = document.createElement("div");
        fill.className = "fill";
        bar.appendChild(fill);
        progress.appendChild(bar);
        bars.push({ bar, fill });
      }

      function setBarClasses(activeIndex) {
        bars.forEach((b, i) => {
          b.bar.classList.toggle("active", i === activeIndex);
          b.bar.classList.toggle("done", i < activeIndex);
          if (i > activeIndex) b.fill.style.width = "0%";
          if (i < activeIndex) b.fill.style.width = "100%";
        });
      }

      // ===== Stories engine (RAF) =====
      let current = 0;
      let paused = false;
      let storyStart = 0;
      let elapsed = 0;
      let rafId = null;

      function stopRaf() {
        if (rafId) cancelAnimationFrame(rafId);
        rafId = null;
      }

      function show(index) {
        stopRaf();

        current = Math.max(0, Math.min(slides.length - 1, index));
        slides.forEach((s, i) => s.classList.toggle("active", i === current));
        setBarClasses(current);

        paused = false;
        elapsed = 0;
        storyStart = 0;

        if (current === slides.length - 1) {
          bars[current].fill.style.width = "100%";
          return;
        }
        rafId = requestAnimationFrame(tick);
      }

      function tick(ts) {
        if (!storyStart) storyStart = ts;

        if (!paused) {
          const delta = ts - storyStart;
          storyStart = ts;
          elapsed += delta;

          const p = Math.min(1, elapsed / CONFIG.storyMs);
          bars[current].fill.style.width = (p * 100).toFixed(3) + "%";

          if (p >= 1) {
            show(current + 1);
            return;
          }
        } else {
          storyStart = ts;
        }
        rafId = requestAnimationFrame(tick);
      }

      function next(){ if (current < slides.length - 1) show(current + 1); }
      function prev(){ if (current > 0) show(current - 1); }
      function pauseStory(){ if (current !== slides.length - 1) paused = true; }
      function resumeStory(){ if (current !== slides.length - 1) paused = false; }

      // ===== Audio start helper =====
      async function tryStartAudio() {
        if (!bgAudio || audioArmed) return;
        audioArmed = true;
        try {
          bgAudio.volume = 0.65;
          bgAudio.muted = isMuted;
          await bgAudio.play();
        } catch (e) {}
      }

      function updateMuteUI(){
        if (!muteBtn) return;
        muteBtn.textContent = isMuted ? "Silencio" : "Sonido";
        muteBtn.classList.toggle("muted", isMuted);
        if (bgAudio) bgAudio.muted = isMuted;
      }

      if (muteBtn){
        muteBtn.addEventListener("click", async (e) => {
          e.stopPropagation();
          await tryStartAudio();
          isMuted = !isMuted;
          updateMuteUI();
        });
      }
      updateMuteUI();

      // Tap nav (izq prev / der next)
      app.addEventListener("click", (e) => {
        const t = e.target;
        if (t && (t.tagName === "BUTTON" || t.closest("button"))) return;
        if (paused) return;

        tryStartAudio();

        const x = e.clientX;
        const w = window.innerWidth;
        if (x < w * 0.28) prev();
        else next();
      });

      // Hold to pause
      app.addEventListener("mousedown", (e) => {
        const t = e.target;
        if (t && (t.tagName === "BUTTON" || t.closest("button"))) return;
        tryStartAudio();
        pauseStory();
      });
      window.addEventListener("mouseup", () => resumeStory());

      app.addEventListener("touchstart", (e) => {
        const t = e.target;
        if (t && (t.tagName === "BUTTON" || t.closest("button"))) return;
        tryStartAudio();
        pauseStory();
      }, { passive: true });
      window.addEventListener("touchend", () => resumeStory(), { passive: true });

      // Keyboard
      window.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight" || e.key === " " || e.key === "Enter") { e.preventDefault(); tryStartAudio(); next(); }
        if (e.key === "ArrowLeft") { e.preventDefault(); tryStartAudio(); prev(); }
        if (e.key.toLowerCase() === "m") { isMuted = !isMuted; updateMuteUI(); }
      });

      // Pause on tab switch
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) pauseStory();
        else resumeStory();
      });

      // CTA
      if (restartBtn) restartBtn.addEventListener("click", () => { tryStartAudio(); show(0); });
    if (nextSectionBtn) nextSectionBtn.addEventListener("click", () => {window.location.href = "menu.html";
});


      // Live clock
      const startMs = new Date(CONFIG.startDateISO).getTime();
      const pad2 = (n) => String(n).padStart(2, "0");
      function tickClock() {
        if (!sinceClock) return;
        const now = Date.now();
        const diff = Math.max(0, now - startMs);
        const sec = Math.floor(diff / 1000);
        const days = Math.floor(sec / 86400);
        const hours = Math.floor((sec % 86400) / 3600);
        const mins = Math.floor((sec % 3600) / 60);
        const s = sec % 60;
        sinceClock.textContent = `${days} días · ${pad2(hours)}:${pad2(mins)}:${pad2(s)}`;
      }
      tickClock();
      setInterval(tickClock, 1000);

      // Start
      show(0);
    })();
  </script>

</body>
</html>
